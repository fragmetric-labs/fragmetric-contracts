/**
 * This code was AUTOGENERATED using the codama library.
 * Please DO NOT EDIT THIS FILE, instead use visitors
 * to add features, then rerun codama to update it.
 *
 * @see https://github.com/codama-idl/codama
 */

import {
  combineCodec,
  fixDecoderSize,
  fixEncoderSize,
  getAddressDecoder,
  getAddressEncoder,
  getBytesDecoder,
  getBytesEncoder,
  getStructDecoder,
  getStructEncoder,
  type Address,
  type Codec,
  type Decoder,
  type Encoder,
  type ReadonlyUint8Array,
} from '@solana/kit';
import {
  getTokenSwapSourcePodDecoder,
  getTokenSwapSourcePodEncoder,
  type TokenSwapSourcePod,
  type TokenSwapSourcePodArgs,
} from '.';

/**
 * A strategy to swap `from_token` to `to_token`.
 *
 * There are two restrictions that will be loosen in the future.
 * These restrictions are not checked on-chain, so fund manager
 * should carefully configure.
 *
 * 1. Each token can be swapped to at most one type of token.
 * In other words, there cannot exist two strategies with same `from_token`.
 * In the future, when there are two or more strategies with same `from_token`,
 * then swap amount will be distributed among those strategies.
 *
 * 2. Each token must be swapped to one of fund's supported tokens.
 * In the future, operation cycle will support multiple-hop swap, for example, A -> B -> C.
 * In this case `to_token` need not be one of fund's supported token.
 * However, to prevent endless swap, token swap strategies must form DAG(vertex = token, edge = strategy).
 */

export type TokenSwapStrategy = {
  fromTokenMint: Address;
  toTokenMint: Address;
  swapSource: TokenSwapSourcePod;
  reserved: ReadonlyUint8Array;
};

export type TokenSwapStrategyArgs = {
  fromTokenMint: Address;
  toTokenMint: Address;
  swapSource: TokenSwapSourcePodArgs;
  reserved: ReadonlyUint8Array;
};

export function getTokenSwapStrategyEncoder(): Encoder<TokenSwapStrategyArgs> {
  return getStructEncoder([
    ['fromTokenMint', getAddressEncoder()],
    ['toTokenMint', getAddressEncoder()],
    ['swapSource', getTokenSwapSourcePodEncoder()],
    ['reserved', fixEncoderSize(getBytesEncoder(), 128)],
  ]);
}

export function getTokenSwapStrategyDecoder(): Decoder<TokenSwapStrategy> {
  return getStructDecoder([
    ['fromTokenMint', getAddressDecoder()],
    ['toTokenMint', getAddressDecoder()],
    ['swapSource', getTokenSwapSourcePodDecoder()],
    ['reserved', fixDecoderSize(getBytesDecoder(), 128)],
  ]);
}

export function getTokenSwapStrategyCodec(): Codec<
  TokenSwapStrategyArgs,
  TokenSwapStrategy
> {
  return combineCodec(
    getTokenSwapStrategyEncoder(),
    getTokenSwapStrategyDecoder()
  );
}
